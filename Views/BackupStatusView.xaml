<UserControl x:Class="better_saving.Views.BackupStatusView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:better_saving.Views"
             xmlns:viewModels="clr-namespace:better_saving.ViewModels"
             xmlns:converters="clr-namespace:better_saving.Converters"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance viewModels:BackupStatusViewModel, IsDesignTimeCreatable=True}"
             d:DesignWidth="350"
             d:DesignHeight="300"
             Background="#FF1E1E1E"
             Margin="0,10,10,10">
    <UserControl.Resources>
        <converters:ProgressToScaleConverter x:Key="ProgressToScaleConverter"/>
        <ScaleTransform x:Key="ViewScale"
                        ScaleX="1.5"
                        ScaleY="1.5"/>
        <!-- Rotation animation for the pausing icon -->
        <Storyboard x:Key="RotateArrows"
                    RepeatBehavior="Forever">
            <DoubleAnimation
                Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                From="0"
                To="360"
                Duration="0:0:1.5"/>
        </Storyboard>
        <!-- Style for rounded ProgressBar -->
        <Style x:Key="RoundedProgressBar"
               TargetType="ProgressBar">
            <Setter Property="Background"
                    Value="#FF001A2E"/>
            <Setter Property="Foreground"
                    Value="#FF1776BA"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid x:Name="TemplateRoot">
                            <Border x:Name="PART_Track"
                                    BorderThickness="0"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="10"/>
                            <Canvas ClipToBounds="False">
                                <Border x:Name="PART_Indicator"
                                        BorderThickness="0"
                                        Background="{TemplateBinding Foreground}"
                                        CornerRadius="10"
                                        Height="{Binding ElementName=PART_Track, Path=ActualHeight}"
                                        HorizontalAlignment="Left">
                                    <Border.Width>
                                        <MultiBinding Converter="{StaticResource ProgressToScaleConverter}">
                                            <Binding RelativeSource="{RelativeSource TemplatedParent}"
                                                     Path="Value"/>
                                            <Binding ElementName="PART_Track"
                                                     Path="ActualWidth"/>
                                        </MultiBinding>
                                    </Border.Width>
                                </Border>
                            </Canvas>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Border CornerRadius="30"
            Background="#FF161618">
        <Grid MinWidth="330"
              MinHeight="280"
              Margin="10,10,10,10">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Title -->
                <RowDefinition Height="Auto"/>
                <!-- Job Name -->
                <RowDefinition Height="Auto"/>
                <!-- Source Directory -->
                <RowDefinition Height="Auto"/>
                <!-- Target Directory -->
                <RowDefinition Height="Auto"/>
                <!-- Job Type -->
                <RowDefinition Height="35.737"/>
                <RowDefinition Height="1.263"/>
                <!-- Progress Bar and Text -->
                <RowDefinition Height="Auto"/>
                <!-- Job State -->
                <RowDefinition Height="Auto"/>
                <!-- Error Message -->
                <RowDefinition Height="Auto"/>
                <!-- Action Buttons -->
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0"
                       Text="{DynamicResource JobStatusDetailsTitle}"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="White"
                       Margin="10,0,0,20"/>

            <StackPanel Grid.Row="1"
                        Orientation="Horizontal"
                        Margin="0,3,0,3">
                <TextBlock Text="{DynamicResource Name}"
                           FontWeight="SemiBold"
                           Foreground="White"
                           Width="130"
                           TextAlignment="Right"
                           Margin="0,0,5,0"/>
                <TextBlock Text="{Binding JobName, Mode=OneWay}"
                           Foreground="White"/>
            </StackPanel>

            <StackPanel Grid.Row="4"
                        Orientation="Horizontal"
                        Margin="0,3,0,3">
                <TextBlock Text="{DynamicResource Type}"
                           FontWeight="SemiBold"
                           Foreground="White"
                           Width="130"
                           TextAlignment="Right"
                           Margin="0,0,5,0"/>
                <TextBlock Text="{Binding JobType, Mode=OneWay}"
                           Foreground="White"/>
            </StackPanel>

            <StackPanel Grid.Row="9"
                        Orientation="Horizontal"
                        Margin="0,5,0,45"
                        Visibility="{Binding ErrorMessage, Mode=OneWay, Converter={StaticResource NullOrEmptyToVisibilityConverter}, FallbackValue=Collapsed}">
                <TextBlock Text="{DynamicResource ErrorLabel}"
                           FontWeight="Bold"
                           Foreground="#FFFF0500"
                           Width="130"
                           TextAlignment="Right"
                           Margin="0,0,5,0"/>
                <TextBox Text="{Binding ErrorMessage, Mode=OneWay}"
                         Foreground="#FFFF0500"
                         TextWrapping="Wrap"
                         IsReadOnly="True"
                         BorderThickness="0"
                         Width="300" Background="{x:Null}" BorderBrush="{x:Null}"/>
            </StackPanel>

            <!-- Combined Progress Display -->
            <Grid Grid.Row="5"
                  Margin="0,10,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <!-- Single column for both ProgressBar and TextBlock -->
                </Grid.ColumnDefinitions>
                <ProgressBar Grid.Column="0"
                             Value="{Binding JobProgress, Mode=OneWay}"
                             Minimum="0"
                             Maximum="100"
                             Height="22"
                             VerticalAlignment="Center"
                             Style="{StaticResource RoundedProgressBar}"/>
                <TextBlock Grid.Column="0"
                           Foreground="White"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Right"
                           Margin="0,0,10,0">
                <Run Text="{Binding JobProgress, Mode=OneWay, StringFormat={}{0:0}%}"/>
                <Run Text=" - "/>
                <Run Text="{Binding TotalFilesCopied, Mode=OneWay}"/>/<Run Text="{Binding TotalFilesToCopy, Mode=OneWay}"/>
                </TextBlock>
            </Grid>

            <StackPanel Grid.Row="7"
                        Orientation="Horizontal"
                        Margin="0,5,0,10"
                        HorizontalAlignment="Center">
                <TextBlock Text="{Binding JobState, Mode=OneWay}"
                           FontWeight="Bold"
                           Foreground="LightSkyBlue"
                           Width="100"
                           Height="25"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>
            </StackPanel>
            <!-- Action Buttons -->
            <Grid Grid.Row="9"
                  Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
            </Grid>

        </Grid>
    </Border>
</UserControl>
